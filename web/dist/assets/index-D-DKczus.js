import{r as o,j as t,I as S,m as k}from"./index-ChmIVYvI.js";import{E as b}from"./index-uuTTqyVK.js";import{c as O,u as L}from"./graphql-Dmc8clCH.js";const E=()=>{const[l,j]=o.useState([]),[x,c]=o.useState(!0),[h]=O(),[m,D]=o.useState([0,0]),d=o.useCallback(async(e,s)=>{const{data:a}=await h({variables:{start:e,end:s}});a&&(j(a.getClockDrifts),D([e,s]),c(!1))},[h]),[f]=L(),p=o.useCallback(async(e=3600*1e3)=>{try{const{data:s}=await f();if(s){const a=s.getCurrentTime.timestamp,i=a-e;await d(i,a)}}catch{}},[f,d]);o.useEffect(()=>{p()},[p]);const v=o.useMemo(()=>[{label:"10 min",ms:600*1e3},{label:"30 min",ms:1800*1e3},{label:"60 min",ms:3600*1e3},{label:"6 hours",ms:360*60*1e3},{label:"12 hours",ms:720*60*1e3},{label:"24 hours",ms:1440*60*1e3},{label:"48 hours",ms:2880*60*1e3},{label:"72 hours",ms:4320*60*1e3}],[]),u=o.useRef(null),N=o.useCallback(async()=>{var a,i;const e=new Date(((a=u.current)==null?void 0:a.value)??0).getTime(),s=e+1440*60*1e3;if(!e){(i=u.current)==null||i.focus();return}c(!0),await d(e,s),c(!1)},[d]),{longOption:w,shortOption:T}=o.useMemo(()=>{if(!l.length)return{longOption:{},shortOption:{}};const e=l.map(r=>[r.timestamp,r.shortTermDrift,r]),s=l.map(r=>[r.timestamp,r.longTermDrift,r]),a=r=>{const n=r.data[2];return`<div style="font-size:13px;">
            <b>${new Date(n.timestamp).toLocaleString("en-US")}</b>
            <br/><br/>

            <b>Reference Server:</b> ${n.reference}<br/>
            <b>Short-term Drift:</b> ${n.shortTermDrift.toFixed(3)} ppm<br/>
            <b>Long-term Drift:</b> ${n.longTermDrift.toFixed(3)} ppm<br/>
        </div>`},i=r=>{const n=new Date(r),y=n.getHours().toString().padStart(2,"0"),C=n.getMinutes().toString().padStart(2,"0");return`${y}:${C}`};return{longOption:{tooltip:{trigger:"item",formatter:a},yAxis:{type:"value",name:"Drift (ppm)"},dataZoom:[{type:"inside",throttle:50}],series:[{type:"scatter",symbolSize:8,data:s}],xAxis:{type:"time",axisLabel:{formatter:i,hideOverlap:!0,interval:"auto",rotate:0}}},shortOption:{tooltip:{trigger:"item",formatter:a},yAxis:{type:"value",name:"Drift (ppm)"},dataZoom:[{type:"inside",throttle:50}],series:[{type:"scatter",symbolSize:8,data:e}],xAxis:{type:"time",axisLabel:{formatter:i,hideOverlap:!0,interval:"auto",rotate:0}}}}},[l]),g=e=>e?new Intl.DateTimeFormat("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(new Date(e)):"";return t.jsxs("div",{className:"mx-4 flex flex-col space-y-4 md:mt-6",children:[t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx("h2",{className:"mb-2 text-4xl font-extrabold text-gray-800",children:"Clock Drifts Visualization"}),m[0]!==0&&m[1]!==0&&t.jsxs("span",{className:"font-mono text-gray-700",children:["Displaying data from",t.jsxs("b",{children:[" ",g(m[0])," "]}),"to",t.jsxs("b",{children:[" ",g(m[1])]}),"."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{className:"btn btn-sm",onClick:()=>{p(),c(!0)},children:[t.jsx(S,{path:k,size:.85,className:"opacity-80"}),t.jsx("span",{children:"Refresh"})]}),v.map(({label:e,ms:s})=>t.jsx("button",{className:"btn btn-sm",onClick:()=>{p(s),c(!0)},children:e},e))]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{required:!0,ref:u,type:"date",className:"input input-sm font-mono text-sm outline-0"}),t.jsx("button",{onClick:N,className:"btn btn-sm",children:"Search"})]})]}),t.jsxs("div",{className:"flex h-[500px] w-full flex-col",children:[t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Long-term Clock Drift"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Long-term drift shows the clock frequency deviation averaged over a longer window. It reflects the hardware oscillatorâ€™s baseline stability and long-range behavior."})]}),x?t.jsx("span",{className:"loading loading-spinner loading-xl m-auto text-gray-500"}):l.length?t.jsx(b,{option:w,style:{width:"100%",height:"100%"}}):t.jsx("span",{className:"m-auto text-gray-500",children:"Nothing to show."})]}),t.jsxs("div",{className:"flex h-[500px] w-full flex-col rounded-md",children:[t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Short-term Clock Drift"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Short-term drift captures rapid frequency fluctuations over a short window. It represents short-timescale jitter or temperature-related variations."})]}),x?t.jsx("span",{className:"loading loading-spinner loading-xl m-auto text-gray-500"}):l.length?t.jsx(b,{option:T,style:{width:"100%",height:"100%"}}):t.jsx("span",{className:"m-auto text-gray-500",children:"Nothing to show."})]})]})};export{E as default};
