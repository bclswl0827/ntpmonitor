import{r as a,j as e,I as K,m as X}from"./index-ChmIVYvI.js";import{d as Y,e as Z,f as _,g as $,h as ee,i as te,j as se,k as re,l as ae,b as ne,m as ie,n as le,o as oe,p as de}from"./graphql-Dmc8clCH.js";const ce=({password:r})=>{const[f]=Y(),u=async()=>{confirm("Are you sure to purge all offset records?");try{await f()}catch{}},[m]=Z(),p=async()=>{confirm("Are you sure to purge all drift records?");try{await m()}catch{}},[g,x]=a.useState({failureRetries:!1,pollingInterval:!1,pollingTimeout:!1,ppmWindow:!1,referenceServer:!1,retentionDays:!1}),[s,v]=a.useState({failureRetries:0,pollingInterval:0,pollingTimeout:0,ppmWindow:0,referenceServer:"",retentionDays:0}),[[R],[D],[P],[k],[I],[C]]=[_(),$(),ee(),te(),se(),re()],A=a.useMemo(()=>[{id:"failureRetries",type:"number",title:"Failure Retries",description:"The program issues multiple concurrent requests to the reference server. If a request fails, it will retry up to the limit defined by Failure Retries. A value of 0 disables retry attempts.",onSubmit:async()=>await R({variables:{password:r,retries:s.failureRetries}})},{id:"pollingInterval",type:"number",title:"Polling Interval",description:"Polling Interval defines the query frequency (1 - 86,400 seconds). After each query, the program measures time and frequency offsets. Some servers may block frequent requests, so adjust as needed.",onSubmit:async()=>await D({variables:{password:r,interval:s.pollingInterval}})},{id:"pollingTimeout",type:"number",title:"Polling Timeout",description:"Polling Timeout sets the query timeout (1 - 300 seconds). If a query exceeds this timeout and overlaps the next interval, that cycle is skipped.",onSubmit:async()=>await P({variables:{password:r,timeout:s.pollingTimeout}})},{id:"ppmWindow",type:"number",title:"PPM Measurement Window",description:"PPM Window sets the time range for long-term drift calculation. Larger windows smooth results; smaller windows respond faster.",onSubmit:async()=>await k({variables:{password:r,window:s.ppmWindow}})},{id:"referenceServer",type:"text",title:"Reference NTP Server",description:"Reference NTP Server specifies the authoritative time source used for comparison. It should have low RTT and a low Stratum, and its address must differ from all observation servers.",onSubmit:async()=>await I({variables:{password:r,server:s.referenceServer}})},{id:"retentionDays",type:"number",title:"Data Retention Days",description:"Data Retention Days sets how long offset and drift data are kept. Data older than this are deleted. 0 disables the feature.",onSubmit:async()=>await C({variables:{password:r,days:s.retentionDays}})}],[s.failureRetries,s.pollingInterval,s.pollingTimeout,s.ppmWindow,s.referenceServer,s.retentionDays,r,R,D,P,k,I,C]),{data:o,loading:L,error:M,refetch:W}=ae({variables:{password:r}});a.useEffect(()=>{!L&&!M&&o&&v({failureRetries:o.getGlobalSettings.failureRetries,pollingInterval:o.getGlobalSettings.pollingInterval,pollingTimeout:o.getGlobalSettings.pollingTimeout,ppmWindow:o.getGlobalSettings.ppmWindow,referenceServer:o.getGlobalSettings.referenceServer,retentionDays:o.getGlobalSettings.retentionDays})},[o,M,L]);const[q,E]=a.useState([]),{data:w,loading:O,error:T,refetch:N}=ne({pollInterval:60*1e3});a.useEffect(()=>{!O&&!T&&w&&E(w.getObserveNTPServerList.map(t=>({...t})))},[w,T,O]);const[F,{loading:G}]=ie(),U=async()=>{if(!(!i.name.trim().length||!i.address.trim().length))try{const{name:t,address:n,remark:d}=i;await F({variables:{password:r,name:t,address:n,remark:d}}),await N(),j({name:"",address:"",remark:""})}catch{}},[i,j]=a.useState({name:"",address:"",remark:""}),[l,h]=a.useState({}),[Q,{loading:z}]=le(),V=async()=>{try{const{name:t,address:n,remark:d}=l;await Q({variables:{password:r,name:t,address:n,remark:d,uuid:l.uuid}}),await N(),h({})}catch{}},[B,{loading:H}]=oe(),J=async t=>{confirm("Are you sure to remove this NTP server?");try{await B({variables:{password:r,uuid:t}}),await N()}catch{}};return e.jsxs("div",{className:"mx-4 flex flex-col space-y-6 md:mt-6",children:[e.jsxs("div",{className:"mb-4 flex flex-col space-y-2 space-x-4 md:flex-row md:items-center",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-gray-800",children:"Global Settings"}),e.jsxs("button",{className:"btn btn-sm max-w-fit",onClick:()=>{N()},children:[e.jsx(K,{path:X,size:.85,className:"opacity-80"}),e.jsx("span",{children:"Refresh"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn btn-sm bg-red-500 text-white",onClick:u,children:e.jsx("span",{children:"Purge Offset Records"})}),e.jsx("button",{className:"btn btn-sm bg-red-500 text-white",onClick:p,children:e.jsx("span",{children:"Purge Drift Records"})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 xl:grid-cols-3",children:A.map(({id:t,title:n,description:d,type:b,onSubmit:y})=>e.jsxs("div",{className:"bg-base-100 flex w-full flex-col rounded-md p-6 shadow",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:n}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:d}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("input",{className:"input input-sm flex-1 outline-0",value:s[t],onChange:S=>v(c=>({...c,[t]:b==="number"?Number(S.target.value):S.target.value})),type:b}),e.jsx("button",{className:"btn btn-sm",onClick:async()=>{x({...g,[t]:!0});try{await y(),await W()}catch{}x({...g,[t]:!1})},disabled:g[t],children:g[t]?"Applying":"Apply"})]})]},t))}),e.jsxs("div",{className:"bg-base-100 rounded-md p-6 shadow",children:[e.jsxs("div",{className:"mb-4 flex flex-col justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Observation NTP Servers"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Servers listed below are used for continuous offset observation."})]}),e.jsx("div",{className:"overflow-x-scroll text-nowrap",children:e.jsxs("table",{className:"table-md table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Remark"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Updated At"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"bg-base-200",children:[e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:i.name,placeholder:"Name",onChange:({target:t})=>j({...i,name:t.value})})}),e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:i.address,placeholder:"Address",onChange:({target:t})=>j({...i,address:t.value})})}),e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:i.remark,placeholder:"Remark",onChange:({target:t})=>j({...i,remark:t.value})})}),e.jsx("td",{colSpan:2}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-xs",onClick:U,disabled:G,children:"Add"})})]}),q.sort((t,n)=>n.createdAt-t.createdAt).map(({uuid:t,name:n,address:d,remark:b,createdAt:y,updatedAt:S})=>l.uuid===t?e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:l.name??"",onChange:({target:c})=>h({...l,name:c.value})})}),e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:l.address??"",onChange:({target:c})=>h({...l,address:c.value})})}),e.jsx("td",{children:e.jsx("input",{className:"input input-sm w-full outline-0",value:l.remark??"",onChange:({target:c})=>h({...l,remark:c.value})})}),e.jsx("td",{children:new Date(y).toLocaleString("en-US")}),e.jsx("td",{children:new Date(S).toLocaleString("en-US")}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-xs",onClick:V,disabled:z,children:"Save"}),e.jsx("button",{className:"btn btn-xs",onClick:()=>h({}),children:"Cancel"})]})]},t):e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{children:n}),e.jsx("td",{className:"font-mono",children:d}),e.jsx("td",{children:b}),e.jsx("td",{children:new Date(y).toLocaleString()}),e.jsx("td",{children:new Date(S).toLocaleString()}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-xs",onClick:()=>{h({uuid:t,name:n,address:d,remark:b})},children:"Edit"}),e.jsx("button",{className:"btn btn-xs",onClick:()=>J(t),disabled:H,children:"Del"})]})]},t))]})]})})]})]})},ue=({onLoginSuccess:r})=>{const[f]=de(),u=a.useRef(null),[m,p]=a.useState(""),g=async()=>{var v;p("");const x=((v=u.current)==null?void 0:v.value)??"",{data:s}=await f({variables:{password:x}});(s==null?void 0:s.verifyPassword)===!0?r(x):p("Invalid password")};return e.jsx("div",{className:"flex h-96 items-center justify-center md:h-screen",children:e.jsxs("div",{className:"w-full max-w-sm rounded-md border border-gray-200 bg-white p-8 shadow-md",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold text-gray-700",children:"Sign In"}),e.jsx("input",{ref:u,type:"password",className:"input w-full bg-gray-50 text-gray-800 outline-0",placeholder:"Enter password"}),m&&e.jsx("div",{className:"mt-2 font-mono text-sm text-red-500",children:m}),e.jsx("button",{onClick:g,className:"btn btn-md bg-base-200 hover:bg-base-300 mt-4 w-full rounded-md border font-semibold text-gray-700",children:"Login"})]})})},ge=()=>{const[r,f]=a.useState(!1),[u,m]=a.useState("");return r?e.jsx(ce,{password:u}):e.jsx(ue,{onLoginSuccess:p=>{m(p),f(!0)}})};export{ge as default};
